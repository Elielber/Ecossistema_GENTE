<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üîç Forense | Auditoria Cient√≠fica de Decis√µes</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
   <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/legacy/build/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/legacy/build/pdf.worker.min.js';</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; padding-bottom: 80px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <header class="bg-slate-900 text-white p-4 shadow-md sticky top-0 z-50 border-b-4 border-slate-700">
        <h1 class="text-lg font-bold tracking-tight">üîç Forense</h1>
        <p class="text-[11px] text-slate-400 font-medium uppercase tracking-widest">Auditoria Cient√≠fica e Rastreabilidade</p>
    </header>

    <main class="p-4">

        <section id="tab-analisar" class="tab-content active">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 mb-4">
                <h2 class="font-semibold text-slate-800 mb-2">Acervo Documental da Auditoria</h2>
                <p class="text-xs text-slate-500 mb-5 leading-relaxed">
                    Classifique e carregue os documentos que comp√µem esta decis√£o. O Forense agrupar√° of√≠cios e votos como <strong>"Tese Oficial"</strong>, e artigos ou manifestos como <strong>"Contraponto/Contexto"</strong>.
                </p>
                
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                    <div class="mb-3">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1">Classifica√ß√£o do Documento:</label>
                        <select id="doc-classificacao" class="w-full text-sm p-2 border border-slate-300 rounded-md bg-white text-slate-700 focus:outline-none focus:border-slate-500">
                            <optgroup label="Documentos Oficiais (Tese)">
                                <option value="oficial_voto">Voto de Diretoria</option>
                                <option value="oficial_memorando">Memorando / Portaria</option>
                                <option value="oficial_oficio">Of√≠cio</option>
                            </optgroup>
                            <optgroup label="Contexto e Contraponto (Ant√≠tese)">
                                <option value="critica_abaixoassinado">Abaixo-assinado / Manifesto</option>
                                <option value="critica_artigo">Artigo T√©cnico / Estudo</option>
                                <option value="critica_publicidade">Publicidade / Mat√©ria</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1">Arquivo (PDF ou TXT):</label>
                        <input type="file" id="doc-arquivo" accept=".pdf,.txt" class="block w-full text-sm text-slate-500 file:mr-3 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-bold file:bg-slate-200 file:text-slate-700 hover:file:bg-slate-300 cursor-pointer">
                    </div>
                    
                    <button onclick="adicionarDocumento()" class="w-full bg-slate-200 text-slate-700 font-semibold py-2 rounded-md hover:bg-slate-300 transition text-xs uppercase tracking-wide">
                        + Adicionar ao Dossi√™
                    </button>
                </div>

                <div class="mb-6">
                    <h3 class="text-xs font-bold text-slate-700 uppercase border-b border-slate-200 pb-1 mb-2">Documentos em Mem√≥ria</h3>
                    <ul id="lista-documentos" class="space-y-2 empty:after:content-['Nenhum_documento_carregado.'] empty:after:text-xs empty:after:text-slate-400"></ul>
                </div>

                <button onclick="processarDossie()" id="btn-processar" class="w-full bg-slate-800 text-white font-semibold py-3 rounded-lg shadow-sm hover:bg-slate-900 transition flex justify-center items-center text-sm uppercase tracking-wide">
                    Executar Auditoria Cient√≠fica
                </button>
                
                <div id="loading-indicator" class="hidden text-center mt-3 text-xs text-slate-600 font-medium animate-pulse uppercase tracking-widest">
                    Processando Acervo Documental...
                </div>
            </div>
        </section>

        <section id="tab-relatorio" class="tab-content">
            <div id="resultado-vazio" class="text-center text-slate-500 py-10">
                <p class="text-sm">Aguardando processamento documental.</p>
            </div>
            
            <div id="resultado-preenchido" class="hidden space-y-4">
                
                <div class="bg-white p-5 rounded-xl border-l-4 border-slate-800 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest">Estrutura L√≥gica da Decis√£o</h2>
                        <span class="text-[10px] bg-slate-100 text-slate-500 px-2 py-1 rounded font-mono">M√©todo de Toulmin</span>
                    </div>
                    <p class="text-[11px] text-slate-500 mb-3 border-b border-slate-100 pb-2">O modelo de Toulmin desconstr√≥i o texto identificando a "Alega√ß√£o Central" (a a√ß√£o diretiva imposta) e as suas "Garantias" jur√≠dicas e institucionais.</p>
                    
                    <h3 class="font-semibold text-sm text-slate-800 mb-1">Alternativas Impostas (Alega√ß√£o):</h3>
                    <ul id="lista-alternativas" class="list-disc list-inside text-sm text-slate-700 mb-3 space-y-1"></ul>
                </div>

                <div class="bg-white p-5 rounded-xl border-l-4 border-blue-600 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-xs font-bold text-blue-600 uppercase tracking-widest">Infer√™ncia de Prioridades</h2>
                        <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded font-mono">An√°lise de Conte√∫do (Bardin)</span>
                    </div>
                    <p class="text-[11px] text-slate-500 mb-3 border-b border-slate-100 pb-2">A An√°lise de Conte√∫do de Laurence Bardin rastreia a frequ√™ncia e a coocorr√™ncia sem√¢ntica das palavras para inferir o peso qualitativo atribu√≠do pelo decisor a cada crit√©rio.</p>
                    
                    <h3 class="font-semibold text-sm text-slate-800 mb-1">Crit√©rios-Matriz Extra√≠dos:</h3>
                    <div id="tags-criterios" class="flex flex-col gap-2 mt-2"></div>
                </div>

                <div class="bg-white p-5 rounded-xl border-l-4 border-amber-500 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-xs font-bold text-amber-600 uppercase tracking-widest">Auditoria de Vieses e Omiss√µes</h2>
                        <span class="text-[10px] bg-amber-50 text-amber-600 px-2 py-1 rounded font-mono">An√°lise Cr√≠tica (ACD)</span>
                    </div>
                    <p class="text-[11px] text-slate-500 mb-3 border-b border-slate-100 pb-2">A An√°lise Cr√≠tica do Discurso (Norman Fairclough) investiga o enquadramento institucional, identificando pontos de tens√£o (vi√©s de confirma√ß√£o e omiss√µes estrat√©gicas) em rela√ß√£o aos contrapontos.</p>
                    
                    <ul id="lista-alertas" class="space-y-4 text-sm text-slate-700 mt-2"></ul>
                </div>
				<div class="bg-white p-5 rounded-xl border-l-4 border-indigo-600 shadow-sm mt-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xs font-bold text-indigo-600 uppercase tracking-widest">Proje√ß√£o Estrat√©gica de Cen√°rios</h2>
                        <span class="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded font-mono">Teoria dos Jogos</span>
                    </div>
                    <p class="text-[11px] text-slate-500 mb-4 border-b border-slate-100 pb-3">C√°lculo preditivo do comportamento organizacional p√≥s-decis√£o (Equil√≠brio de Nash), baseado no choque de interesses extra√≠do dos documentos.</p>
                    
                    <div id="matriz-plays-container" class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                        </div>
                    
                    <div class="mt-4 flex items-center justify-between">
                        <div class="text-[11px] text-slate-500">Para detalhamento gr√°fico e simula√ß√£o avan√ßada:</div>
                        <button onclick="switchTab('exportar')" class="text-xs text-indigo-600 font-bold hover:underline">Ver Exporta√ß√£o PLAYS &rarr;</button>
                    </div>
                </div>
            </div>
        </section>

       <section id="tab-briefing" class="tab-content">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 mb-4">
                <div class="flex items-center justify-between mb-2">
                    <h2 class="font-semibold text-slate-800">Resumo Executivo (Preview)</h2>
                    <span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded font-bold uppercase">Tom Relacional</span>
                </div>
                
                <div id="texto-resumo" class="text-sm text-slate-700 leading-relaxed space-y-3 bg-slate-50 p-4 rounded-lg border border-slate-100 mb-6">
                    Execute a auditoria para visualizar o resumo.
                </div>
                
                <h2 class="font-semibold text-slate-800 mb-2 border-t border-slate-100 pt-4">Distribui√ß√£o Estrat√©gica</h2>
                <p class="text-[11px] text-slate-500 mb-4">
                    O <strong>WhatsApp</strong> copiar√° o texto relacional acima. O <strong>PDF</strong> gerar√° o dossi√™ com o aprofundamento das 4 metodologias.
                </p>
                
                <div class="space-y-3">
                    <button onclick="copiarZap()" class="w-full bg-[#25D366] text-white font-bold py-3 px-4 rounded-lg shadow-sm hover:bg-[#1da851] transition text-sm flex items-center justify-between">
                        <span class="flex items-center gap-2">
                            <span class="text-lg">üí¨</span> Enviar Resumo p/ WhatsApp
                        </span>
                        <span class="text-[10px] uppercase opacity-80 font-normal tracking-widest">Copiar</span>
                    </button>
                    
                    <button onclick="baixarPDF()" class="w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg shadow-sm hover:bg-slate-900 transition text-sm flex items-center justify-between uppercase tracking-wide">
                        <span class="flex items-center gap-2">
                            <span class="text-lg">üìÑ</span> Dossi√™ Anal√≠tico (PDF)
                        </span>
                        <span class="text-[10px] opacity-80 font-normal tracking-widest">Baixar</span>
                    </button>
                </div>
            </div>
        </section>
		
        <section id="tab-exportar" class="tab-content">
            <div class="grid grid-cols-1 gap-4">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">Exporta√ß√£o Matem√°tica (ANP)</h3>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">M√©todo de Saaty</span>
                    </div>
                    <p class="text-xs text-slate-500 mb-4">Gera a matriz estruturada para o <strong>Analytic Network Process</strong>. Fundamental para calcular a Raz√£o de Consist√™ncia (CR) e provar a integridade l√≥gica dos pesos decis√≥rios adotados na portaria.</p>
                    <button onclick="exportarANP()" class="bg-slate-800 text-white px-4 py-3 rounded-lg text-xs font-bold uppercase w-full tracking-widest hover:bg-slate-700">Baixar JSON (ANP-Solver)</button>
                </div>
                
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">Mapeamento Sist√™mico (CATWOE)</h3>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Sistemas Checkland</span>
                    </div>
                    <p class="text-xs text-slate-500 mb-4">Exporta a taxonomia da decis√£o para o <strong>Peixe-Voador</strong>, organizando o problema sob a √≥tica dos Atores, Transforma√ß√£o, Vis√£o de Mundo e Restri√ß√µes Ambientais.</p>
                    <button onclick="exportarPeixe()" class="bg-slate-600 text-white px-4 py-3 rounded-lg text-xs font-bold uppercase w-full tracking-widest hover:bg-slate-500">Baixar JSON (Peixe-Voador)</button>
                </div>
				<div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-slate-800 text-sm uppercase">Proje√ß√£o de Cen√°rios (PLAYS)</h3>
                        <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded">Teoria dos Jogos</span>
                    </div>
                    <p class="text-xs text-slate-500 mb-4">Exporta o choque de interesses detectado nos documentos para simular as rea√ß√µes (Equil√≠brio de Nash) na ferramenta <strong>PLAYS</strong>.</p>
                    <button onclick="exportarPLAYS()" class="bg-indigo-600 text-white px-4 py-3 rounded-lg text-xs font-bold uppercase w-full tracking-widest hover:bg-indigo-500">Baixar JSON (PLAYS)</button>
                </div>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 w-full bg-white border-t border-slate-200 flex justify-around items-center h-16 px-2 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-50">
        <button onclick="switchTab('analisar')" class="nav-btn active flex flex-col items-center p-2 text-slate-400 w-1/4" data-target="tab-analisar">
            <span class="text-xl mb-1">‚öôÔ∏è</span>
            <span class="text-[10px] font-bold uppercase">Auditar</span>
        </button>
        <button onclick="switchTab('relatorio')" class="nav-btn flex flex-col items-center p-2 text-slate-400 w-1/4" data-target="tab-relatorio">
            <span class="text-xl mb-1">üìä</span>
            <span class="text-[10px] font-bold uppercase">Resultados</span>
        </button>
        <button onclick="switchTab('briefing')" class="nav-btn flex flex-col items-center p-2 text-slate-400 w-1/4" data-target="tab-briefing">
            <span class="text-xl mb-1">üìë</span>
            <span class="text-[10px] font-bold uppercase">Parecer</span>
        </button>
        <button onclick="switchTab('exportar')" class="nav-btn flex flex-col items-center p-2 text-slate-400 w-1/4" data-target="tab-exportar">
            <span class="text-xl mb-1">üì§</span>
            <span class="text-[10px] font-bold uppercase">Exportar</span>
        </button>
    </nav>

    <style>
        .nav-btn.active { color: #0f172a; } 
        .nav-btn.active span:first-child { transform: scale(1.1); transition: 0.2s; }
    </style>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            document.querySelector(`[data-target="tab-${tabId}"]`).classList.add('active');
            window.scrollTo(0, 0);
        }

        // --- Vari√°veis de Estado Global ---
        let dossieDocumentos = []; // Array que guardar√° os arquivos e classifica√ß√µes
        let dadosAuditoria = { alternativas: [], criteriosDirex: [], alertas: [], rawTextDirex: "", rawTextCritica: "" };

        // =====================================================================
        // GERENCIADOR DE DOCUMENTOS (Nova L√≥gica de M√∫ltiplos Arquivos)
        // =====================================================================
        function adicionarDocumento() {
            const inputClassificacao = document.getElementById('doc-classificacao');
            const inputArquivo = document.getElementById('doc-arquivo');
            const file = inputArquivo.files[0];

            if (!file) {
                alert("Por favor, selecione um arquivo PDF ou TXT.");
                return;
            }

            // Pega o texto da op√ß√£o selecionada (ex: "Voto de Diretoria")
            const nomeClassificacao = inputClassificacao.options[inputClassificacao.selectedIndex].text;
            const tipo = inputClassificacao.value; // ex: "oficial_voto"

            dossieDocumentos.push({
                id: Date.now(),
                file: file,
                tipo: tipo,
                nomeAmigavel: nomeClassificacao,
                nomeArquivo: file.name
            });

            inputArquivo.value = ""; // Limpa o input
            atualizarListaDocumentos();
        }

        function removerDocumento(id) {
            dossieDocumentos = dossieDocumentos.filter(doc => doc.id !== id);
            atualizarListaDocumentos();
        }

        function atualizarListaDocumentos() {
            const ul = document.getElementById('lista-documentos');
            ul.innerHTML = dossieDocumentos.map(doc => `
                <li class="flex justify-between items-center bg-white border border-slate-200 p-2 rounded-md shadow-sm">
                    <div class="flex flex-col overflow-hidden">
                        <span class="text-[10px] font-bold text-slate-400 uppercase">${doc.nomeAmigavel}</span>
                        <span class="text-xs text-slate-700 truncate">${doc.nomeArquivo}</span>
                    </div>
                    <button onclick="removerDocumento(${doc.id})" class="text-red-500 hover:bg-red-50 p-1 rounded">
                        üóëÔ∏è
                    </button>
                </li>
            `).join('');
        }

        // =====================================================================
        // FUN√á√ÉO PRINCIPAL DE PROCESSAMENTO (Substitui a anterior)
        // =====================================================================
        async function processarDossie() {
            const btn = document.getElementById('btn-processar');
            const loader = document.getElementById('loading-indicator');
            
            // Valida√ß√£o de Governan√ßa: Exige pelo menos um documento oficial
            const temOficial = dossieDocumentos.some(doc => doc.tipo.startsWith('oficial_'));
            if (!temOficial) {
                alert("Para fins de auditoria, adicione pelo menos um Documento Oficial (Voto, Memorando ou Of√≠cio).");
                return;
            }

            btn.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                let textoOficialAcumulado = "";
                let textoCriticaAcumulado = "";

                // L√™ todos os arquivos carregados na mem√≥ria de forma ass√≠ncrona
                for (const doc of dossieDocumentos) {
                    // ATEN√á√ÉO: Mant√©m a sua fun√ß√£o lerArquivoTextoOPDF com a Blob URL intacta!
                    const textoExtraido = await lerArquivoTextoOPDF({ files: [doc.file] }); 
                    
                    // Agrupa os textos conforme a taxonomia
                    if (doc.tipo.startsWith('oficial_')) {
                        textoOficialAcumulado += textoExtraido + " \n\n ";
                    } else if (doc.tipo.startsWith('critica_')) {
                        textoCriticaAcumulado += textoExtraido + " \n\n ";
                    }
                }
                
                dadosAuditoria.rawTextDirex = textoOficialAcumulado;
                dadosAuditoria.rawTextCritica = textoCriticaAcumulado;
                
                // === APLICA√á√ÉO DOS MOTORES ANAL√çTICOS (Sem alterar os motores originais) ===
                dadosAuditoria.alternativas = extratorToulmin(textoOficialAcumulado);
                dadosAuditoria.criteriosDirex = extratorBardin(textoOficialAcumulado);
                dadosAuditoria.alertas = extratorFairclough(textoOficialAcumulado, textoCriticaAcumulado);

               setTimeout(() => {
                    renderizarRelatorio();
                    renderizarProjecaoPlays(); 
					gerarResumoExecutivo();
                    btn.classList.remove('hidden');
                    loader.classList.add('hidden');
                    switchTab('relatorio');
                }, 1200);

            } catch (error) {
                alert("Falha t√©cnica na extra√ß√£o. Verifique os arquivos.");
                console.error(error);
                btn.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }

        async function lerArquivoTextoOPDF(fileInput) {
            const file = fileInput.files[0];
            if (!file) return "";
            
            if (file.type === "application/pdf") {
                // Truque arquitetural: Cria uma URL virtual local (Blob URL).
                // Mant√©m o Zero-Trust (nada vai para a internet) e evita o erro RangeError (-1),
                // pois permite que o pdf.js use seu leitor nativo otimizado.
                const fileUrl = URL.createObjectURL(file);
                
                try {
                    const pdf = await pdfjsLib.getDocument(fileUrl).promise;
                    let fullText = "";
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        fullText += textContent.items.map(item => item.str).join(" ") + " ";
                    }
                    
                    // Limpa a URL virtual da mem√≥ria do celular para n√£o causar vazamento de RAM
                    URL.revokeObjectURL(fileUrl); 
                    return fullText;
                    
                } catch (pdfError) {
                    URL.revokeObjectURL(fileUrl); // Limpa a mem√≥ria mesmo em caso de erro
                    console.error("Erro interno no motor PDF:", pdfError);
                    alert("Aviso: Este PDF possui uma trava militar ou corrup√ß√£o de cabe√ßalho. Para audit√°-lo, salve-o como .txt (Bloco de Notas) e carregue novamente.");
                    throw pdfError;
                }
            } else {
                return await file.text(); // L√™ arquivos de texto simples normalmente
            }
        }

        // =====================================================================
        // MOTORES METODOL√ìGICOS (Intelig√™ncia Din√¢mica e Global)
        // =====================================================================
        function extratorToulmin(textoBase) {
            let alternativasEncontradas = [];
            // Regex alargada para detetar qualquer ordem institucional:
            const regexAcao = /(?:aprov[ou|ar|a]+|decidi[u|r]|extin[√ß√£o|guiu|gir]|institu[iu|ir]|determina(?:-se)?|retorno\s+a[o]?)\s+([^,\.]+)/gi;
            let match;
            
            while ((match = regexAcao.exec(textoBase)) !== null) {
                if(match[1].length > 8 && match[1].length < 80) {
                    let textoLimpo = match[1].trim();
                    textoLimpo = textoLimpo.charAt(0).toUpperCase() + textoLimpo.slice(1);
                    alternativasEncontradas.push(textoLimpo);
                }
            }
            let unicas = [...new Set(alternativasEncontradas)];
            return unicas.length > 0 ? unicas : ["Implementa√ß√£o de Nova Diretriz de Gest√£o"];
        }

        function extratorBardin(textoBase) {
            const textoLower = textoBase.toLowerCase();
            // Taxonomia Universal da Gest√£o P√∫blica e Corporativa
            const taxonomia = {
                "Cultura e Sinergia Organizacional": ["cultura", "integra√ß√£o", "pertencimento", "alinhamento", "colabora√ß√£o", "clima", "presencial", "sinergia"],
                "Seguran√ßa e Conformidade": ["passivo", "jur√≠dic", "controle", "jornada", "legisla√ß√£o", "seguran√ßa", "ponto", "roleta", "lei"],
                "Desempenho Institucional": ["desempenho", "produtividade", "efici√™ncia", "resultados", "entregas", "metas"],
                "Sustentabilidade Financeira": ["financeiro", "custo", "despesa", "or√ßamento", "economia", "gasto", "financeira"]
            };

            let criteriosExtraidos = [];
            for (let [categoria, radicais] of Object.entries(taxonomia)) {
                let frequencia = 0;
                radicais.forEach(radical => {
                    let regex = new RegExp(radical + "\\w*", "g");
                    let ocorrencias = textoLower.match(regex);
                    if (ocorrencias) frequencia += ocorrencias.length;
                });

                if (frequencia > 0) {
                    let pesoQualitativo = frequencia >= 4 ? "Alta densidade e prioriza√ß√£o" : "Relev√¢ncia secund√°ria";
                    criteriosExtraidos.push({
                        nome: categoria, 
                        frequencia: frequencia,
                        analise: `[Bardin] Dete√ß√£o de ${frequencia} termos associados. ${pesoQualitativo} na constru√ß√£o da narrativa prim√°ria.`
                    });
                }
            }
            return criteriosExtraidos.sort((a, b) => b.frequencia - a.frequencia);
        }

        function extratorFairclough(textoDir, textoCrit) {
            let alertas = [];
            
            if (textoCrit && textoCrit.trim().length > 10) {
                // A intelig√™ncia din√¢mica cruza os pesos sem√¢nticos (Bardin) de ambos os lados para encontrar assimetrias
                const criteriosOficial = extratorBardin(textoDir);
                const criteriosCritica = extratorBardin(textoCrit);
                
                const nomesOficial = criteriosOficial.map(c => c.nome);
                
                criteriosCritica.forEach(c => {
                    if (c.frequencia >= 2 && !nomesOficial.includes(c.nome)) {
                        alertas.push(`<strong>Vi√©s de Enquadramento:</strong> O documento secund√°rio foca a sua argumenta√ß√£o em '<strong>${c.nome}</strong>'. A omiss√£o total deste l√©xico na diretriz oficial configura um ponto cego t√°tico (risco de governan√ßa em inst√¢ncias superiores).`);
                    }
                    if (c.frequencia >= 2 && nomesOficial.includes(c.nome)) {
                        alertas.push(`<strong>Ruptura de Signos:</strong> Diverg√™ncia diametral detetada no crit√©rio '<strong>${c.nome}</strong>'. As partes utilizam o mesmo fundamento conceptual para defender cen√°rios operacionais opostos. Requer blindagem quantitativa urgente.`);
                    }
                });
                
                if (alertas.length === 0) {
                    alertas.push("<strong>Alinhamento Narrativo:</strong> N√£o foram detetadas omiss√µes severas ou disputas sem√¢nticas diretas entre a decis√£o e o contraponto fornecido.");
                }
                
            } else {
                alertas.push("<strong>Isola√ß√£o (Groupthink):</strong> A decis√£o foi estruturada sem evid√™ncia de contraponto. O vi√©s de isola√ß√£o institucional √© alto. Em situa√ß√µes cr√≠ticas, recomenda-se mapear resist√™ncias preventivamente.");
            }
            return alertas;
        }

        // =====================================================================
        // FUN√á√ÉO PRINCIPAL DE PROCESSAMENTO 
        // =====================================================================
        async function processarArquivos() {
            const btn = document.getElementById('btn-processar');
            const loader = document.getElementById('loading-indicator');
            const fileDecisao = document.getElementById('file-decisao');
            
            if (!fileDecisao.files.length) {
                alert("Para fins de auditoria, o carregamento do documento oficial √© obrigat√≥rio.");
                return;
            }

            btn.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                // Extrai os textos puros dos arquivos
                const textoDirex = await lerArquivoTextoOPDF(document.getElementById('file-decisao'));
                const textoCritica = await lerArquivoTextoOPDF(document.getElementById('file-critica'));
                
                dadosAuditoria.rawTextDirex = textoDirex;
                dadosAuditoria.rawTextCritica = textoCritica;
                
                // === APLICA√á√ÉO DOS MOTORES ANAL√çTICOS ===
                dadosAuditoria.alternativas = extratorToulmin(textoDirex);
                dadosAuditoria.criteriosDirex = extratorBardin(textoDirex);
                dadosAuditoria.alertas = extratorFairclough(textoDirex, textoCritica);

                // Delay estrat√©gico para percep√ß√£o de processamento complexo
                setTimeout(() => {
                    renderizarRelatorio();
                    btn.classList.remove('hidden');
                    loader.classList.add('hidden');
                    switchTab('relatorio');
                }, 1200);

            } catch (error) {
                alert("Falha t√©cnica no processamento do documento. Verifique se o PDF √© um texto leg√≠vel (n√£o imagem).");
                console.error(error);
                btn.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }

        function renderizarRelatorio() {
            document.getElementById('resultado-vazio').classList.add('hidden');
            document.getElementById('resultado-preenchido').classList.remove('hidden');

            document.getElementById('lista-alternativas').innerHTML = dadosAuditoria.alternativas.map(a => `<li><span class="font-medium text-slate-800">${a}</span></li>`).join('');

            document.getElementById('tags-criterios').innerHTML = dadosAuditoria.criteriosDirex.map(c => 
                `<div class="bg-slate-50 border border-slate-200 p-2 rounded"><div class="font-bold text-slate-800 text-sm">${c.nome}</div><div class="text-[11px] text-slate-500 mt-1">${c.analise}</div></div>`
            ).join('');

            document.getElementById('lista-alertas').innerHTML = dadosAuditoria.alertas.map(a => `<li class="relative pl-5 before:content-[''] before:absolute before:left-0 before:top-2 before:w-2 before:h-2 before:bg-amber-500 before:rounded-full">${a}</li>`).join('');
        }

        
        // =====================================================================
        // MOTORES DE DISTRIBUI√á√ÉO (Resumo em Tela e WhatsApp)
        // =====================================================================

        function gerarResumoExecutivo() {
            if(!dadosAuditoria.alternativas.length) return;
            
            const temConflito = dadosAuditoria.alertas.some(a => a.includes("Disputa") || a.includes("Vi√©s"));
            const criterioPrincipal = dadosAuditoria.criteriosDirex[0]?.nome || "vari√°veis internas";
            
            let html = `<p><strong>Decis√£o Mapeada:</strong> ${dadosAuditoria.alternativas[0]}</p>`;
            html += `<p><strong>Foco da Narrativa:</strong> O algoritmo identificou que o peso maior da nossa justificativa est√° estruturado em <em>${criterioPrincipal}</em>.</p>`;
            
            if (temConflito) {
                html += `<p><strong>‚ö†Ô∏è Ponto de Aten√ß√£o:</strong> O cruzamento dos documentos aponta um desalinhamento importante com o p√∫blico afetado.</p>`;
                html += `<p><strong>Sugest√£o T√°tica:</strong> Para evitar um desgaste invis√≠vel (queda de produtividade), seria estrat√©gico pensarmos em alguma flexibiliza√ß√£o ou contrapartida operacional que traga a equipe para um cen√°rio de colabora√ß√£o.</p>`;
            } else {
                html += `<p><strong>Cen√°rio:</strong> O ambiente aponta para a absor√ß√£o da regra. Vale apenas monitorarmos o clima da equipe nos pr√≥ximos meses.</p>`;
            }
            
            document.getElementById('texto-resumo').innerHTML = html;
        }

        function copiarZap() {
            if(!dadosAuditoria.alternativas.length) return alert("Execute a auditoria primeiro.");
            
            const temConflito = dadosAuditoria.alertas.some(a => a.includes("Disputa") || a.includes("Vi√©s"));
            const criterioPrincipal = dadosAuditoria.criteriosDirex[0]?.nome || "crit√©rios internos";
            
            // Texto conversacional para WhatsApp
            let zap = `Ol√°! Passando para compartilhar um panorama r√°pido da an√°lise que rodei no sistema sobre a nossa decis√£o de *${dadosAuditoria.alternativas[0]}*.\n\n`;
            
            zap += `O algoritmo confirmou que a nossa justificativa est√° muito bem ancorada em *${criterioPrincipal}*.\n\n`;
            
            if(temConflito) {
                zap += `üö® *Ponto de aten√ß√£o:* O cruzamento dos documentos detectou um desalinhamento forte com a base (risco de resist√™ncia silenciosa).\n\n`;
                zap += `üí° *Sugest√£o:* Para n√£o travarmos a opera√ß√£o num cen√°rio de perde-perde, talvez seja interessante pensarmos em alguma contrapartida operacional ou projeto de gest√£o paralela para trazer a equipe de volta para o ganha-ganha.\n\n`;
            } else {
                zap += `üìä *Cen√°rio:* O sistema projeta que a decis√£o ser√° absorvida com tranquilidade, mas sugere acompanharmos o engajamento da equipe.\n\n`;
            }
            
            zap += `Se precisar do detalhamento t√©cnico para anexar a algum processo, me avisa que te mando o Dossi√™ completo em PDF gerado pelo sistema. Um abra√ßo!`;

            navigator.clipboard.writeText(zap).then(() => {
                alert("Resumo relacional copiado! Pronto para colar no WhatsApp.");
            });
        }

        function baixarPDF() {
            if(!dadosAuditoria.alternativas.length) return alert("Execute a auditoria primeiro.");
            const { jsPDF } = window.jspdf; 
            const doc = new jsPDF();
            
            let y = 0; 
            const margin = 20; 
            const maxWidth = 170; 
            const pageHeight = 280;
            const primaryColor = [20, 30, 50]; 
            const secondaryColor = [80, 90, 110]; 
            const accentColor = [37, 99, 235];
            
            function checkPageBreak(requiredSpace = 20) {
                if (y + requiredSpace > pageHeight) {
                    doc.addPage();
                    drawHeaderFooter();
                    y = 35; 
                }
            }

            function drawHeaderFooter() {
                const pageNum = doc.internal.getCurrentPageInfo().pageNumber;
                if (pageNum > 1) {
                    doc.setFillColor(245, 247, 250); doc.rect(0, 0, 210, 20, 'F');
                    doc.setFontSize(8); doc.setFont("helvetica", "bold"); doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]); doc.text("GENTE FORENSE", margin, 12);
                    doc.setFont("helvetica", "normal"); doc.setTextColor(150, 150, 150); doc.text("Auditoria Cient√≠fica de Decis√µes Institucionais", 210 - margin, 12, {align: "right"});
                    doc.setDrawColor(220, 220, 220); doc.line(margin, 20, 210 - margin, 20);
                }
                doc.setDrawColor(220, 220, 220); doc.line(margin, 285, 210 - margin, 285);
                doc.setFontSize(8); doc.setFont("helvetica", "italic"); doc.setTextColor(150, 150, 150);
                doc.text(`Gerado com seguran√ßa (Zero-Trust) em ${new Date().toLocaleDateString('pt-BR')}`, margin, 292);
                doc.setFont("helvetica", "normal"); doc.text(`P√°gina ${pageNum}`, 210 - margin, 292, {align: "right"});
            }

            function printParagraph(title, text, isMainTitle = false) {
                if(isMainTitle) {
                    checkPageBreak(30); y += 5; doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                    doc.text(title, margin, y); y += 2; doc.setDrawColor(accentColor[0], accentColor[1], accentColor[2]); doc.setLineWidth(0.5); doc.line(margin, y, margin + 20, y); y += 8;
                } else if(title) {
                    checkPageBreak(15); doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(secondaryColor[0], secondaryColor[1], secondaryColor[2]);
                    doc.text(title, margin, y); y += 6;
                }
                doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.setTextColor(60, 60, 60);
                const lines = doc.splitTextToSize(text, maxWidth); checkPageBreak(lines.length * 5);
                doc.text(lines, margin, y); y += (lines.length * 5.5) + 6; 
            }

            // --- CAPA ---
            doc.setFillColor(primaryColor[0], primaryColor[1], primaryColor[2]); doc.rect(0, 0, 210, 80, 'F');
            doc.setFontSize(24); doc.setFont("helvetica", "bold"); doc.setTextColor(255, 255, 255); doc.text("PARECER T√âCNICO", margin, 45);
            doc.setFontSize(12); doc.setFont("helvetica", "normal"); doc.setTextColor(200, 210, 230); doc.text("Auditoria de Rastreabilidade e Cen√°rios Prospectivos", margin, 55);

            y = 100;
            doc.setFontSize(10); doc.setFont("helvetica", "bold"); doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]); doc.text("S√çNTESE EXECUTIVA", margin, y); y += 8;
            doc.setFont("helvetica", "normal");
            
            const txtCapa = "Compreendemos que transi√ß√µes estruturais e imposi√ß√µes de alto impacto sist√©mico s√£o os momentos mais sens√≠veis na Alta Gest√£o. Este relat√≥rio apoia as lideran√ßas com um diagn√≥stico isento que valida os aspetos priorit√°rios da decis√£o, rastreia assimetrias de interpreta√ß√£o e projeta potenciais rea√ß√µes na malha organizacional. O documento atua como radar preventivo na sustentabilidade das mudan√ßas propostas.";
            doc.text(doc.splitTextToSize(txtCapa, maxWidth), margin, y); drawHeaderFooter();
            
            // --- P√ÅGINA 2 ---
            doc.addPage(); drawHeaderFooter(); y = 35;
            printParagraph("1. Objeto da An√°lise e Estrutura", "Decis√£o Mapeada: " + dadosAuditoria.alternativas.join(" | "), true);
            printParagraph("An√°lise L√≥gica (Toulmin)", "A heur√≠stica validou o corpo documental para isolar e fixar o foco da 'Alega√ß√£o Central', desconsiderando ru√≠dos informativos e focando na mudan√ßa institucional promovida.");

            printParagraph("2. Fundamenta√ß√£o Qualitativa (Axiologia)", "", true);
            printParagraph("", "Baseado no m√©todo de Laurence Bardin, mape√°mos a densidade dos vocabul√°rios para inferir onde a Dire√ß√£o colocou o seu peso de argumenta√ß√£o e foco:");
            dadosAuditoria.criteriosDirex.forEach(c => printParagraph("‚Ä¢ " + c.nome.toUpperCase(), c.analise));

            // --- P√ÅGINA 3 ---
            doc.addPage(); drawHeaderFooter(); y = 35;
            printParagraph("3. Riscos de Governan√ßa (An√°lise Cr√≠tica)", "", true);
            printParagraph("", "O motor Fairclough cruzou a densidade argumentativa prim√°ria com o contexto paralelo/manifesta√ß√µes em busca de desn√≠veis interpretativos e vieses de gest√£o:");
            
            if(dadosAuditoria.alertas.length > 0) {
                dadosAuditoria.alertas.forEach(a => printParagraph("Alerta de Desvio Detectado", a.replace(/<\/?strong>/g, "")));
            } else {
                printParagraph("Diagn√≥stico de Seguran√ßa", "O acervo encontra-se conc√™ntrico; n√£o foram mapeadas fissuras discursivas evidentes nesta amostra documental.");
            }

            printParagraph("4. Proje√ß√£o Estrat√©gica (Teoria dos Jogos)", "", true);
            const temConflito = dadosAuditoria.alertas.some(a => a.includes("Ruptura") || a.includes("Vi√©s") || a.includes("Isola√ß√£o"));
            const nash = temConflito ? "DD (Lose-Lose / Travamento e Retalia√ß√£o Oculta)" : "DC (Conformidade Funcional / Submiss√£o √† Nova Regra)";
            printParagraph("Equil√≠brio de Nash Projetado", "Estado Inicial Prov√°vel: " + nash);
            
            let nashText = temConflito 
                ? "Conclus√£o: Identificou-se uma grave assimetria de interesses e interpreta√ß√£o entre as partes envolvidas. Manter uma imposi√ß√£o r√≠gida for√ßar√° o sistema a ancorar no quadrante DD, prop√≠cio √† resist√™ncia n√£o-declarada, perda de qualidade sist√©mica ou atrito persistente. √â imperativo adotar mecanismos t√°ticos (a√ß√µes flexibilizadoras, compensat√≥rias ou comunica√ß√µes ativas) com a inten√ß√£o deliberada de reconduzir a base ao quadrante de Coopera√ß√£o (CC)."
                : "Conclus√£o: Prev√™-se uma absor√ß√£o adequada da mudan√ßa. Como a submiss√£o formal (DC) pode n√£o reter motiva√ß√£o de longo prazo na base, os l√≠deres operacionais devem atuar na mitiga√ß√£o dos primeiros sintomas de desgaste e confirmar a adapta√ß√£o natural √† norma imposta.";
            printParagraph("Recomenda√ß√£o Consultiva", nashText);

            doc.save("Parecer_Consultivo_GENTE_Forense_Global.pdf");
        }
        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportarANP() {
            if(!dadosAuditoria.alternativas.length) return alert("Execute a an√°lise t√©cnica primeiro.");
            const anpData = {
                metadata: { judgeRole: "Assessoria T√©cnica Especializada", context: "Modelagem Forense da Decis√£o", frameworkUsed: "Toulmin + Bardin" },
                dynamicClusters: {
                    ObjetivoPrincipal: "Auditoria Cient√≠fica do Regime de Trabalho",
                    "Criterios de Decisao": { elements: dadosAuditoria.criteriosDirex.map(c => c.nome) },
                    "Alternativas para alcane do Objetivo": { elements: dadosAuditoria.alternativas }
                }
            };
            downloadJSON(anpData, 'Auditoria_Estrutura_ANP.json');
        }

        function exportarPeixe() {
             if(!dadosAuditoria.alternativas.length) return alert("Execute a an√°lise t√©cnica primeiro.");
             const peixeData = {
                effect: "Restabelecimento da Coes√£o Institucional e Seguran√ßa de Conformidade",
                sector: "generic",
                causes: {
                    transformation: dadosAuditoria.alternativas.map(a => ({text: "*" + a})),
                    worldview: dadosAuditoria.criteriosDirex.map(c => ({text: c.nome + " como vetor inegoci√°vel da institui√ß√£o."}))
                }
            };
            downloadJSON(peixeData, 'Auditoria_Mapeamento_CATWOE.json');
        }

        
		function exportarPLAYS() {
            if(!dadosAuditoria.alternativas.length) return alert("Execute a an√°lise t√©cnica primeiro.");
            
            // Verifica se houve contraponto (Manifesto vs Decis√£o)
            const temConflito = dadosAuditoria.alertas.some(a => a.includes("Disputa") || a.includes("Vi√©s"));
            
            const playsData = {
              "projectMeta": {
                "title": "Proje√ß√£o Forense: " + dadosAuditoria.alternativas[0],
                "context": "An√°lise de impactos e rea√ß√µes p√≥s-decis√£o institucional.",
                "objective": "Mapear o Equil√≠brio de Nash do conflito documental."
              },
              "nodes": [
                {
                  "id": "decisao_oficial",
                  "label": "A Decis√£o:\n" + dadosAuditoria.alternativas[0],
                  "group": "project",
                  "title": "Ato imposto pelo documento oficial"
                },
                {
                  "id": "jogador_A",
                  "label": "Gest√£o (DIREX)\n(Autor do Voto)",
                  "group": "actor",
                  "interest": 8, // Interesse alto extra√≠do pelo peso de Bardin
                  "title": "Objetivo: " + (dadosAuditoria.criteriosDirex[0]?.nome || "Conformidade")
                },
                {
                  "id": "jogador_B",
                  "label": "Corpo Funcional\n(Autores do Manifesto)",
                  "group": "actor",
                  "interest": temConflito ? -7 : 2, // Se houver contraponto, o interesse √© negativo (rejei√ß√£o)
                  "title": "Objetivo: Manuten√ß√£o de benef√≠cios / Flexibilidade"
                },
                {
                  "id": "estrat_DD",
                  "label": "Cen√°rio DD:\nImposi√ß√£o x Resist√™ncia",
                  "group": "strategy",
                  "color": "#ef4444",
                  "title": "Queda de moral, judicializa√ß√£o e perda de produtividade oculta."
                },
                {
                  "id": "estrat_CC",
                  "label": "Cen√°rio CC:\nAlinhamento T√°tico",
                  "group": "strategy",
                  "color": "#10b981",
                  "title": "Gest√£o mant√©m regra, mas oferece contrapartida operacional."
                }
              ],
              "edges": [
                { "from": "jogador_A", "to": "decisao_oficial", "label": "Imp√µe", "arrows": "to" },
                { "from": "jogador_B", "to": "decisao_oficial", "label": "Sofre Impacto", "arrows": "to" },
                { "from": "estrat_DD", "to": "jogador_B", "label": "Risco Iminente", "arrows": "to", "dashes": true, "color": { "color": "#ef4444" } },
                { "from": "estrat_CC", "to": "jogador_B", "label": "Rota de Mitiga√ß√£o", "arrows": "to", "width": 2, "color": { "color": "#10b981" } }
              ],
              "gameMatrix": {
                "currentState": temConflito ? "DD" : "DC",
                "targetState": "CC",
                "payoffs": {
                  "CC": { "A": 6, "B": 5, "description": "Conformidade com manuten√ß√£o de engajamento." },
                  "CD": { "A": -2, "B": 6, "description": "Recuo institucional enfraquece a governan√ßa." },
                  "DC": { "A": 7, "B": -4, "description": "Conformidade for√ßada; risco de Turnover." },
                  "DD": { "A": -3, "B": -3, "description": "Conflito aberto, desgaste institucional." }
                }
              }
            };
            
            downloadJSON(playsData, 'Auditoria_Projecao_PLAYS.json');
        }
		// =====================================================================
        // MOTOR DE PROJE√á√ÉO (Teoria dos Jogos / PLAYS Embutido)
        // =====================================================================
        function renderizarProjecaoPlays() {
            const container = document.getElementById('matriz-plays-container');
            
            // Verifica se h√° conflito (manifesto/oposi√ß√£o)
            const temConflito = dadosAuditoria.alertas.some(a => a.includes("Disputa") || a.includes("Vi√©s"));
            
            // Defini√ß√£o dos Atores
            const decisor = "A: Gest√£o";
            const impactado = "B: Equipes";
            
            // Estado de Nash (Se h√° conflito, tende a DD. Se n√£o, tende a DC)
            const nashState = temConflito ? "DD (Conflito/Travamento)" : "DC (Conformidade Passiva)";
            const bgColorNash = temConflito ? "bg-red-100 border-red-300" : "bg-blue-100 border-blue-300";
            const txtColorNash = temConflito ? "text-red-700" : "text-blue-700";

            // Desenha a Matriz 2x2 Simplificada
            container.innerHTML = `
                <div class="mb-3">
                    <span class="text-[10px] font-bold text-slate-500 uppercase">Equil√≠brio de Nash Projetado:</span>
                    <div class="mt-1 font-bold text-sm ${txtColorNash} ${bgColorNash} border px-3 py-2 rounded">
                        ${nashState}
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-1 text-center text-[10px]">
                    <div></div>
                    <div class="font-bold text-slate-600 bg-slate-200 py-1 rounded rounded-b-none">${impactado}<br>Aceita/Coopera</div>
                    <div class="font-bold text-slate-600 bg-slate-200 py-1 rounded rounded-b-none">${impactado}<br>Resiste/Rejeita</div>
                    
                    <div class="font-bold text-slate-600 bg-slate-200 py-2 flex items-center justify-center rounded rounded-r-none">${decisor}<br>Alinha/Mitiga</div>
                    <div class="border border-slate-300 bg-white p-2 flex flex-col justify-center">
                        <span class="font-bold text-emerald-600 text-xs">CC (Ganha-Ganha)</span>
                        <span class="text-[9px] text-slate-500 mt-1">Produtividade e Controle</span>
                    </div>
                    <div class="border border-slate-300 bg-white p-2 flex flex-col justify-center opacity-60">
                        <span class="font-bold text-slate-700 text-xs">CD</span>
                        <span class="text-[9px] text-slate-500 mt-1">Perda de Autoridade</span>
                    </div>
                    
                    <div class="font-bold text-slate-600 bg-slate-200 py-2 flex items-center justify-center rounded rounded-r-none">${decisor}<br>Imp√µe Rigor</div>
                    <div class="border border-slate-300 bg-white p-2 flex flex-col justify-center ${!temConflito ? 'ring-2 ring-blue-400 bg-blue-50' : 'opacity-60'}">
                        <span class="font-bold text-slate-700 text-xs">DC</span>
                        <span class="text-[9px] text-slate-500 mt-1">Risco de Turnover</span>
                    </div>
                    <div class="border border-slate-300 bg-white p-2 flex flex-col justify-center ${temConflito ? 'ring-2 ring-red-400 bg-red-50' : 'opacity-60'}">
                        <span class="font-bold ${temConflito ? 'text-red-600' : 'text-slate-700'} text-xs">DD (Lose-Lose)</span>
                        <span class="text-[9px] text-slate-500 mt-1">Desgaste e Queda Oculta</span>
                    </div>
                </div>
                
                <p class="text-[10px] text-slate-500 mt-3 italic text-center">
                    ${temConflito 
                        ? "Aviso: A imposi√ß√£o r√≠gida frente a forte oposi√ß√£o documental trava a matriz no quadrante DD. Recomenda-se estrat√©gia de mitiga√ß√£o (CC)."
                        : "Cen√°rio de conformidade com submiss√£o (DC). Monitorar indicadores de reten√ß√£o de talentos no m√©dio prazo."}
                </p>
            `;
        }
    </script>
</body>

</html>
